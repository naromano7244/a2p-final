<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A2P Compliance Guide</title>
  <!-- A2P Results v1.7.1 ‚Äì Larger/cleaner copy boxes + top tip banner about special characters -->

  <!-- Perf hints -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://script.google.com" crossorigin>
  <link rel="preconnect" href="https://i.ibb.co" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box}
    :root{
      --primary:#5c27d4; --primary-2:#6e3de8; --primary-light:#f3efff;
      --text:#2d3748; --muted:#667085; --border:#e2e8f0;
      --success:#48bb78; --danger:#e11d48;
      --shadow-sm:0 2px 6px rgba(0,0,0,.06);
      --shadow-md:0 10px 30px rgba(0,0,0,.10); --r-md:14px; --r-sm:10px;
    }
    body{font-family:Inter,system-ui,-apple-system,"Segoe UI",sans-serif;margin:0;background:#f7f7fa;color:var(--text);line-height:1.6}
    .container{max-width:920px;margin:34px auto;background:#fff;border-radius:var(--r-md);box-shadow:var(--shadow-md);overflow:hidden}
    @media (max-width:980px){.container{margin:18px}}

    .header{
      background:linear-gradient(135deg,var(--primary),var(--primary-2));
      color:#fff;text-align:center;padding:38px 22px;position:relative
    }
    .header::after{content:"";position:absolute;left:0;right:0;bottom:0;height:4px;background:linear-gradient(90deg,#4c21b0,#6e3de8)}
    .header h1{margin:0;font-size:28px;font-weight:800;line-height:1.25;letter-spacing:-.2px}
    .header p{margin:12px 0 0;font-size:15.5px;opacity:.95}

    .disclosure{
      background:#fff3cd;color:#7a5a00;border:1px solid #ffe08a;
      border-radius:var(--r-sm);padding:10px 16px;margin:18px 24px 0;text-align:center;font-size:14px
    }

    .section{padding:28px 28px;border-top:1px solid var(--border)}
    .section:first-of-type{border-top:0}

    h2{font-size:20px;margin:0 0 14px;color:var(--primary);display:flex;align-items:center;gap:10px}
    .muted{color:var(--muted)}
    .soft-card{background:#f9f9ff;border:1px solid #e9e3ff;border-radius:14px;padding:16px}

    .callout{
      border-radius:14px;padding:16px;border:1px solid var(--border);
      background:linear-gradient(180deg,#ffffff, #fbfbff);
      box-shadow:var(--shadow-sm)
    }
    .big-note{
      margin-top:10px;padding:12px;border-radius:12px;
      background:var(--primary-light);border:1px solid #e5dcff
    }

    /* NEW: tip banner styling (uses existing callout) */
    .tip-callout{
      border-color:#fde68a;
      background:#fffbeb;
    }

    /* Website box */
    .site-box{
      margin-top:12px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      padding:14px;
      box-shadow:var(--shadow-sm);
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .site-left{min-width:240px;flex:1}
    .site-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px}
    .site-link{
      display:block;
      font-weight:800;
      color:var(--primary);
      text-decoration:none;
      word-break:break-word;
      font-size:15px;
    }
    .site-link:hover{text-decoration:underline}
    .site-actions{display:flex;align-items:center;gap:10px}

    /* UPDATED: larger/cleaner copy boxes */
    pre{
      background:#f8fafc;
      padding:18px 18px;
      border-radius:14px;
      white-space:pre-wrap;
      word-break:break-word;

      font-size:15px;
      line-height:1.55;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;

      border:1px solid var(--border);
      margin:12px 0;
      color:#1f2937;
    }

    .copy-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

    /* UPDATED: slightly larger nicer buttons */
    .copy-btn{
      background:var(--primary);color:#fff;border:0;
      padding:10px 16px;
      font-size:14px;
      border-radius:12px;
      cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:var(--shadow-sm);
      transition:transform .12s ease, opacity .12s ease
    }
    .copy-btn:hover{transform:translateY(-1px);opacity:.95}
    .copied-msg{display:inline-flex;align-items:center;color:var(--success);font-weight:700;font-size:13.5px}
    .warn{
      margin-top:10px;
      border:1px solid #fecaca;
      background:#fff1f2;
      color:#9f1239;
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      display:none;
    }

    ul{padding-left:20px;margin:12px 0}
    li{margin-bottom:10px}
    li::marker{color:var(--primary)}

    .tips-img{
      width:100%;height:auto;border-radius:12px;border:1px solid var(--border);
      box-shadow:var(--shadow-sm);margin-top:12px;background:#f8fafc
    }

    .pdf-section{background:var(--primary-light);text-align:center;padding:32px}
    .pdf-section h3{margin:0 0 12px;color:var(--primary)}
    .pdf-button{
      display:inline-flex;align-items:center;gap:8px;background:var(--primary);color:#fff;padding:11px 20px;
      border-radius:12px;font-weight:700;text-decoration:none;box-shadow:var(--shadow-sm)
    }
    .pdf-button:hover{opacity:.95}
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üßô‚Äç‚ôÇÔ∏è Just like magic!<br>Your A2P Compliance Kit is Ready!</h1>
      <p>Thanks for using A2P Wizard. Below is everything you need to get your campaign approved.</p>
    </div>

    <div class="disclosure">‚ö†Ô∏è If your campaign was previously rejected, <u>recreate and resubmit</u> a new campaign for best results.</div>

    <!-- NEW: Top tip banner -->
    <div class="section" style="padding-top:16px">
      <div class="callout tip-callout">
        <p style="margin:0;font-size:14.5px">
          ‚ö†Ô∏è <strong>Website not generating?</strong>
          Make sure you did not use special characters in the company name.
          Special characters do not work for web addresses. üôÇ
        </p>
      </div>
    </div>

    <!-- Start Here -->
    <div class="section" id="startHere">
      <h2>üöÄ Start Here</h2>

      <div class="soft-card">
        <p style="margin:0 0 10px">
          <strong>Your custom-built, domain-matched compliance website is ready.</strong>
          It‚Äôs designed to match opt-in requirements and help your campaign get approved.
          Hero images on the website may take up to <strong>60 seconds</strong> to load.
        </p>

        <p class="muted" style="margin:0">
          Use the <strong>Copy & Paste</strong> sections below to fill out your application exactly.
        </p>

        <!-- Website box moved BACK DOWN (visible) -->
        <div class="site-box" style="margin-top:14px">
          <div class="site-left">
            <div class="site-label">Website (Brand must match this)</div>
            <a id="siteLinkA" class="site-link" href="#" target="_blank" rel="noopener">Loading‚Ä¶</a>
            <div id="siteWarn" class="warn"></div>
          </div>
          <div class="site-actions">
            <button class="copy-btn" onclick="copyText('siteLinkA', this)" title="Copy website">
              Copy Website
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div class="section">
      <h2>üìå Instructions</h2>
      <div class="callout">
        <p style="margin:0 0 10px">
          Make sure to <strong>register the brand and campaign using the output below</strong>.
        </p>
        <div class="big-note">
          You <strong>must</strong> register the brand with the <strong>website shown in this output</strong>
          or you will likely face a campaign rejection <strong>~50% of the time</strong>.
        </div>
      </div>
    </div>

    <div class="section">
      <h2>üìÉ Use Case Description</h2>
      <pre id="useCase">Loading use case description...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('useCase', this)">Copy</button>
      </div>
    </div>

    <div class="section">
      <h2>üí¨ Sample Messages</h2>

      <p style="margin:0 0 6px"><strong>Sample Message One:</strong></p>
      <pre id="msg1">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('msg1', this)">Copy</button>
      </div>

      <p style="margin-top:16px;margin-bottom:6px"><strong>Sample Message Two:</strong></p>
      <pre id="msg2">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('msg2', this)">Copy</button>
      </div>
    </div>

    <div class="section">
      <h2>‚úÖ How do Contacts Opt-in to Messages?</h2>
      <pre id="consentCopy">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('consentCopy', this)">Copy</button>
      </div>
    </div>

    <div class="section">
      <h2>üìú Opt-In Message</h2>
      <pre id="optInMessage">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('optInMessage', this)">Copy</button>
      </div>
    </div>

    <!-- Final Step kept -->
    <div class="section">
      <h2>‚úÖ Final Step: HighLevel Opt-In Method</h2>

      <p>
        HighLevel now requires an <strong>Opt-In Method</strong> and a
        <strong>public Opt-in Form / Image URL</strong>.
      </p>

      <ul>
        <li><strong>Opt-In Method:</strong> Website form</li>
        <li>
          <strong>Opt-in Form / Image URL:</strong><br>
          Paste the link below into the HighLevel field exactly as shown.
        </li>
      </ul>

      <pre id="optInFormUrl">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('optInFormUrl', this)">Copy Opt-In URL</button>
      </div>

      <p style="margin-top:10px;font-size:14px;color:var(--muted)">
        ‚úÖ This link must be publicly accessible and show clear consent language.
      </p>
    </div>

    <!-- Tips kept -->
    <div class="section">
      <h2>üí° Tips for Approval</h2>
      <ul>
        <li>Submit between 8am‚Äì11am on weekdays</li>
        <li>Use a fresh number/campaign if resubmitting</li>
        <li>Brand approval usually takes ~24 hours</li>
        <li><strong>Follow all best practices</strong> to avoid delays</li>
      </ul>
      <img
        src="https://i.ibb.co/S4JzfBYz/image-4.png"
        class="tips-img"
        alt="Tips Screenshot"
        loading="lazy"
        decoding="async"
        width="1200"
        height="675"
      >
    </div>

    <div class="pdf-section">
      <h3>Need to send this to a client? Here‚Äôs a white-labeled guide!</h3>
      <a href="#" onclick="window.print()" class="pdf-button">Download PDF</a>
    </div>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);
    function cacheKey(q){ return "a2p_results_" + String(q || "").toLowerCase().trim(); }

    const API_BASE = "https://script.google.com/macros/s/AKfycbxc0m07Q1u1c3JyyKAKTdYvmrkj6C9UxdI-wjIZM7b0uidEreM-G31Ub3LQCObmhiIs/exec";
    const SITE_DOMAIN = "nebulabrandgroup.com";

    async function fetchJSON(url, timeoutMs=12000){
      const ctrl = new AbortController();
      const t = setTimeout(()=>ctrl.abort(), timeoutMs);
      try{
        const r = await fetch(url, {signal: ctrl.signal, cache: "no-store"});
        if(!r.ok) throw new Error("HTTP "+r.status);
        return await r.json();
      } finally { clearTimeout(t); }
    }

    function updateText(id, text){
      const el=$(id);
      if (!el) return;
      el.textContent = text;
    }

    // Sanitize slug more aggressively so website always builds
    function normalizeSlug(slugRaw){
      return String(slugRaw || "")
        .toLowerCase()
        .trim()
        .replace(/\s+/g, "")         // remove spaces
        .replace(/[_]/g, "-")        // underscore -> hyphen (optional)
        .replace(/[^a-z0-9-]/g, ""); // strip anything else
    }

    function buildWebsiteFromSlug(slugRaw){
      const s = normalizeSlug(slugRaw);
      if(!s) return { ok:false, website:"" };
      return { ok:true, website: `https://${s}.${SITE_DOMAIN}` };
    }

    // Accept multiple possible response shapes
    function unwrapRow(resp){
      if(!resp) return null;
      if(resp.ok === false) return resp; // keep explicit fail
      return resp.data || resp.record || resp.row || resp.result || resp;
    }

    function setWebsiteUI(website){
      const siteLinkA = $("siteLinkA");
      const warn = $("siteWarn");

      if(siteLinkA){
        if(website){
          siteLinkA.textContent = website;
          siteLinkA.href = website;
        }else{
          siteLinkA.textContent = "Website link will appear here";
          siteLinkA.href = "#";
        }
      }

      if(warn){
        if(!website){
          warn.style.display = "block";
          warn.innerHTML = `Website could not be generated. This usually means the <strong>Slug</strong> field is missing or invalid in your sheet.`;
        }else{
          warn.style.display = "none";
          warn.textContent = "";
        }
      }
    }

    function hydrate(row){
      if(row && row.ok === false){
        setWebsiteUI("");
        updateText("useCase", "Lookup failed. This record could not be found from the endpoint.");
        updateText("msg1", "‚Äî");
        updateText("msg2", "‚Äî");
        updateText("consentCopy", "‚Äî");
        updateText("optInMessage", "‚Äî");
        updateText("optInFormUrl", "‚Äî");
        return;
      }

      const businessName =
        String((row && (row["Legal Business name"] || row["Legal Business Name"] || row["business_name"])) || "").trim();

      const slug =
        String((row && (row["Slug"] || row["slug"] || row["SLUG"])) || "").trim();

      const bn = businessName || "Client Business";

      const websiteRes = buildWebsiteFromSlug(slug);
      const website = websiteRes.ok ? websiteRes.website : "";
      setWebsiteUI(website);

      updateText("optInFormUrl", (website ? website + "/contact" : "Website link not available yet"));

      updateText("useCase",
`This campaign sends appointment-related SMS messages to customers who request or schedule an appointment with ${bn} via ${website || "[WEBSITE LINK PENDING]"}. Messages include appointment confirmations, reminders, and rescheduling updates. Users provide their mobile number and explicitly opt in by selecting the consent checkbox on the website form.`
      );

       updateText("msg1",
`Hi Adam, this is Alex from ${bn}. Your appointment is confirmed for March 20 at 11:00 AM. Reply STOP to opt out.`
      );

      updateText("msg2",
`Hi John ‚Äî this is Jordan from ${bn}. Thank you for opting in to receive more information about our service. A team member will reach out in the next 24 hours. Reply STOP to opt out. `
      );

      updateText("consentCopy",
`End users opt in by visiting ${website || "[WEBSITE LINK PENDING]"} and submitting a website form to request or schedule an appointment. Users voluntarily provide their mobile number and explicitly consent to receive appointment-related SMS messages by selecting the opt-in checkbox on the form.`
      );

     updateText("optInMessage",
`You‚Äôre opted in to receive appointment-related SMS from ${bn}. Reply STOP to opt out at any time.`
      );
    }

    async function init(){
      const params = new URLSearchParams(location.search);
      const slug = params.get("slug");
      const id = params.get("id");
      const queryVal = (slug || id || "").trim();

      if(!queryVal){
        setWebsiteUI("");
        updateText("useCase", "Waiting for data‚Ä¶");
        updateText("msg1", "Waiting for data‚Ä¶");
        updateText("msg2", "Waiting for data‚Ä¶");
        updateText("consentCopy", "Waiting for data‚Ä¶");
        updateText("optInMessage", "Waiting for data‚Ä¶");
        updateText("optInFormUrl", "Waiting for a link‚Ä¶");
        return;
      }

      const key = cacheKey(queryVal);
      const apiUrl = slug
        ? (API_BASE + "?slug=" + encodeURIComponent(slug))
        : (API_BASE + "?id=" + encodeURIComponent(id));

      try{
        const cached = localStorage.getItem(key);
        if(cached){
          const cachedObj = JSON.parse(cached);
          hydrate(unwrapRow(cachedObj));
          fetchJSON(apiUrl)
            .then(d=>{ localStorage.setItem(key, JSON.stringify(d)); hydrate(unwrapRow(d)); })
            .catch(()=>{});
          return;
        }
      }catch(e){}

      try{
        const data = await fetchJSON(apiUrl, 12000);
        localStorage.setItem(key, JSON.stringify(data));
        hydrate(unwrapRow(data));
      }catch(err){
        console.error("Error fetching data", err);
        setWebsiteUI("");
        updateText("useCase", "We‚Äôre having trouble loading live data. Try refreshing, or check back in a minute.");
      }
    }

    function copyText(elId, btn){
      const el=$(elId);
      if(!el) return;

      const txt = (el.tagName === "A")
        ? (el.href && el.href !== "#" ? el.href : el.textContent.trim())
        : (el.textContent || "").trim();

      if(!txt || txt === "Loading‚Ä¶") return;

      navigator.clipboard.writeText(txt).then(()=>{
        const msg=document.createElement("span");
        msg.className="copied-msg";
        msg.textContent="‚úì Copied!";
        btn.insertAdjacentElement("afterend", msg);
        setTimeout(()=>msg.remove(), 1400);
      });
    }

    init();
  </script>
</body>
</html>




