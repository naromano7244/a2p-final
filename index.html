<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A2P Compliance Guide</title>
  <!-- A2P Results v2.0.0 ‚Äì STOP warning, feature badge, step numbers, random names, print styles -->

  <!-- Perf hints -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://script.google.com" crossorigin>
  <link rel="preconnect" href="https://i.ibb.co" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box}
    :root{
      --primary:#5c27d4; --primary-2:#6e3de8; --primary-light:#f3efff;
      --text:#2d3748; --muted:#667085; --border:#e2e8f0;
      --success:#48bb78; --danger:#e11d48;
      --shadow-sm:0 2px 6px rgba(0,0,0,.06);
      --shadow-md:0 10px 30px rgba(0,0,0,.10); --r-md:14px; --r-sm:10px;
    }
    body{font-family:Inter,system-ui,-apple-system,"Segoe UI",sans-serif;margin:0;background:#f7f7fa;color:var(--text);line-height:1.6}
    .container{max-width:920px;margin:34px auto;background:#fff;border-radius:var(--r-md);box-shadow:var(--shadow-md);overflow:hidden}
    @media (max-width:980px){.container{margin:18px}}

    .header{
      background:linear-gradient(135deg,var(--primary),var(--primary-2));
      color:#fff;text-align:center;padding:38px 22px;position:relative
    }
    .header::after{content:"";position:absolute;left:0;right:0;bottom:0;height:4px;background:linear-gradient(90deg,#4c21b0,#6e3de8)}
    .header h1{margin:0;font-size:28px;font-weight:800;line-height:1.25;letter-spacing:-.2px}
    .header p{margin:12px 0 0;font-size:15.5px;opacity:.95}

    .disclosure{
      background:#fff3cd;color:#7a5a00;border:1px solid #ffe08a;
      border-radius:var(--r-sm);padding:10px 16px;margin:18px 24px 0;text-align:center;font-size:14px
    }

    .section{padding:28px 28px;border-top:1px solid var(--border)}
    .section:first-of-type{border-top:0}

    h2{font-size:20px;margin:0 0 14px;color:var(--primary);display:flex;align-items:center;gap:10px}
    .muted{color:var(--muted)}
    .soft-card{background:#f9f9ff;border:1px solid #e9e3ff;border-radius:14px;padding:16px}

    .callout{
      border-radius:14px;padding:16px;border:1px solid var(--border);
      background:linear-gradient(180deg,#ffffff, #fbfbff);
      box-shadow:var(--shadow-sm)
    }
    .big-note{
      margin-top:10px;padding:12px;border-radius:12px;
      background:var(--primary-light);border:1px solid #e5dcff
    }

    .tip-callout{
      border-color:#fde68a;
      background:#fffbeb;
    }

    /* Website box */
    .site-box{
      margin-top:12px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      padding:14px;
      box-shadow:var(--shadow-sm);
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .site-left{min-width:240px;flex:1}
    .site-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px}
    .site-link{
      display:block;
      font-weight:800;
      color:var(--primary);
      text-decoration:none;
      word-break:break-word;
      font-size:15px;
    }
    .site-link:hover{text-decoration:underline}
    .site-actions{display:flex;align-items:center;gap:10px}

    pre{
      background:#f8fafc;
      padding:18px 18px;
      border-radius:14px;
      white-space:pre-wrap;
      word-break:break-word;

      font-size:15px;
      line-height:1.55;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;

      border:1px solid var(--border);
      margin:12px 0;
      color:#1f2937;
    }

    .copy-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

    .copy-btn{
      background:var(--primary);color:#fff;border:0;
      padding:10px 16px;
      font-size:14px;
      border-radius:12px;
      cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:var(--shadow-sm);
      transition:transform .12s ease, opacity .12s ease
    }
    .copy-btn:hover{transform:translateY(-1px);opacity:.95}
    .copied-msg{display:inline-flex;align-items:center;color:var(--success);font-weight:700;font-size:13.5px}
    
    /* NEW: Upgrade prompt styling */
    .upgrade-prompt{
      margin-top:14px;
      border:2px solid var(--primary);
      background:linear-gradient(135deg, #f3efff, #ffffff);
      border-radius:14px;
      padding:24px;
      text-align:center;
      display:none;
    }
    .upgrade-prompt h4{
      margin:0 0 10px;
      color:var(--primary);
      font-size:19px;
      font-weight:700;
    }
    .upgrade-prompt p{
      margin:0 0 18px;
      color:var(--text);
      font-size:15px;
      line-height:1.5;
    }
    .upgrade-btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background:var(--primary);
      color:#fff;
      padding:13px 28px;
      border-radius:12px;
      font-weight:700;
      font-size:15px;
      text-decoration:none;
      box-shadow:var(--shadow-md);
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .upgrade-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 12px 40px rgba(92,39,212,.25);
    }

    ul{padding-left:20px;margin:12px 0}
    li{margin-bottom:10px}
    li::marker{color:var(--primary)}

    .tips-img{
      width:100%;height:auto;border-radius:12px;border:1px solid var(--border);
      box-shadow:var(--shadow-sm);margin-top:12px;background:#f8fafc
    }

    .pdf-section{background:var(--primary-light);text-align:center;padding:32px}
    .pdf-section h3{margin:0 0 12px;color:var(--primary)}
    .pdf-button{
      display:inline-flex;align-items:center;gap:8px;background:var(--primary);color:#fff;padding:11px 20px;
      border-radius:12px;font-weight:700;text-decoration:none;box-shadow:var(--shadow-sm)
    }
    .pdf-button:hover{opacity:.95}

    /* Feature badge */
    .feature-badge{
      margin-top:14px;
      background:linear-gradient(135deg,#ecfdf5,#f0fdf4);
      border:1px solid #86efac;
      border-radius:12px;
      padding:14px 18px;
      display:flex;
      align-items:flex-start;
      gap:12px;
    }
    .feature-badge .badge-icon{
      font-size:22px;flex-shrink:0;margin-top:1px
    }
    .feature-badge .badge-text{font-size:14px;color:#166534;line-height:1.5}
    .feature-badge .badge-text strong{color:#15803d}
    .feature-badge .badge-chips{
      display:flex;flex-wrap:wrap;gap:6px;margin-top:8px
    }
    .feature-badge .chip{
      background:#dcfce7;color:#166534;font-size:12px;font-weight:600;
      padding:4px 10px;border-radius:20px;border:1px solid #bbf7d0;
      white-space:nowrap
    }

    /* Stop warning */
    .stop-warning{
      background:#fef2f2;border:2px solid #fca5a5;border-radius:14px;
      padding:18px;margin-bottom:0
    }
    .stop-warning h3{
      margin:0 0 10px;color:#dc2626;font-size:18px;font-weight:800;
      display:flex;align-items:center;gap:8px
    }
    .stop-warning p{margin:0 0 10px;font-size:14.5px;color:#7f1d1d;line-height:1.55}
    .stop-warning p:last-child{margin-bottom:0}

    /* Collapsible image preview */
    .img-preview-wrap{
      position:relative;
      max-height:180px;
      min-height:180px;
      overflow:hidden;
      border-radius:12px;
      transition:max-height .4s ease;
    }
    .img-preview-wrap .img-preview-fade{
      position:absolute;
      left:0;right:0;bottom:0;
      height:70px;
      background:linear-gradient(transparent,rgba(255,244,230,.95));
      display:flex;align-items:flex-end;justify-content:center;
      padding-bottom:10px;
      transition:opacity .3s ease;
    }
    .img-preview-wrap .img-preview-fade span{
      font-size:13px;font-weight:600;color:#b45309;
      background:rgba(255,255,255,.85);padding:5px 14px;border-radius:20px;
      box-shadow:0 2px 8px rgba(0,0,0,.08);
    }
    .img-preview-wrap.expanded{
      max-height:2000px;
    }
    .img-preview-wrap.expanded .img-preview-fade{
      opacity:0;pointer-events:none;
    }

    /* Print styles */
    @media print{
      body{background:#fff}
      .container{box-shadow:none;margin:0;border-radius:0}
      .header{background:var(--primary)!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}
      .disclosure,.upgrade-prompt,.pdf-section,.copy-btn,.site-actions{display:none!important}
      .section{break-inside:avoid}
      pre{border:1px solid #ccc;font-size:13px}
      .tips-img{max-height:300px;object-fit:contain}
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üßô‚Äç‚ôÇÔ∏è Just like magic!<br>Your A2P Compliance Kit is Ready!</h1>
      <p>Thanks for using A2P Wizard. Below is everything you need to get your campaign approved.</p>
    </div>

    <div class="disclosure" style="background:var(--primary-light);color:var(--primary);border-color:#e5dcff">
      ‚ö° Want unlimited submissions &amp; priority Slack support?
      <a href="mailto:admin@a2pwizard.com" style="color:var(--primary);font-weight:700;margin-left:4px">Email admin@a2pwizard.com ‚Üí</a>
    </div>

    <!-- Start Here -->
    <div class="section" id="startHere">
      <h2>üöÄ Start Here</h2>

      <div class="soft-card">
        <p style="margin:0 0 10px">
          <strong>Your custom-built, domain-matched compliance website is ready.</strong>
          It's designed to match opt-in requirements and help your campaign get approved.
          Hero images on the website may take up to <strong>60 seconds</strong> to load.
        </p>

        <p class="muted" style="margin:0">
          Use the <strong>Copy & Paste</strong> sections below to fill out your application exactly.
        </p>

        <div class="site-box" style="margin-top:14px">
          <div class="site-left">
            <div class="site-label">Website (Brand must match this)</div>
            <a id="siteLinkA" class="site-link" href="#" target="_blank" rel="noopener">Loading‚Ä¶</a>
          </div>
          <div class="site-actions">
            <button class="copy-btn" onclick="copyText('siteLinkA', this)" title="Copy website">
              Copy Website
            </button>
          </div>
        </div>

        <!-- NEW: Upgrade prompt that shows when rate limited -->
        <div id="upgradePrompt" class="upgrade-prompt">
          <h4>üöÄ Oops! You've Hit Your Rate Limit</h4>
          <p>You've reached the limit for free website generations. Upgrade now for unlimited submissions and priority support!</p>
          <a href="https://a2pwizard.com/done-for-you" class="upgrade-btn" target="_blank" rel="noopener">
            ‚ö° Upgrade Now for Unlimited Access
          </a>
          <p style="margin:16px 0 0;font-size:13px;color:var(--muted)">
            Received this message in error? Please contact <a href="mailto:admin@a2pwizard.com" style="color:var(--primary);text-decoration:none">admin@a2pwizard.com</a>
          </p>
        </div>

        <!-- Feature badge -->
        <div class="feature-badge">
          <span class="badge-icon">‚úÖ</span>
          <div class="badge-text">
            <strong>This is a fully functioning website</strong> ‚Äî complete with Terms of Service, Privacy Policy, and 5 content sections ‚Äî that passes the AI verification system. You're welcome to use it as a live site for your client if you'd like.
            <div class="badge-chips">
              <span class="chip">Terms of Service</span>
              <span class="chip">Privacy Policy</span>
              <span class="chip">5 Content Sections</span>
              <span class="chip">AI Verification Ready</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div class="section">
      <h2>üìå Instructions</h2>
      <div class="stop-warning">
        <h3>üõë STOP ‚Äî Read This First</h3>
        <p>
          <strong>Have you already been rejected? Do you already have a brand approval?</strong>
          If so, you need to open a support ticket with HighLevel (or your CRM's support) and ask them to
          <strong>wipe the brand registration</strong> and start fresh.
        </p>
        <p>
          <strong>Why?</strong> There will be a mismatch between the site you originally used for the brand
          and the A2P Wizard-generated site in the campaign. It only takes about 5 minutes to wipe the brand
          and get it re-approved, but skipping this step can cost you <strong>weeks of headaches</strong>.
        </p>
        <div style="margin-top:12px;padding:12px;background:#fff5f5;border:1px solid #fca5a5;border-radius:10px">
          <p style="margin:0 0 8px;font-weight:700;color:#dc2626;font-size:14px">‚ö†Ô∏è Note on Brand Clearing</p>
          <p style="margin:0;font-size:13.5px;color:#7f1d1d;line-height:1.55">
            HighLevel is encountering issues with actually clearing the brand. After submission, verify with support that the brand was truly cleared ‚Äî not just the GUI. Ask them:
            <strong>"What website do you see on the Twilio brand registration backend?"</strong>
            If they return a different website than the one generated above, or you get rejected for "unverifiable website," it's because they cleared the brand in HighLevel but <em>not</em> the actual Twilio brand application. <strong>We strongly recommend creating a new sub-account or using A2P Wizard on a fresh sub-account.</strong>
          </p>
        </div>
      </div>
    </div>

    <!-- Pro Tips Section -->
    <div class="section">
      <h2>üí° Pro Tip</h2>

      <div class="callout" style="background:#fff4e6;border-color:#ffd69a;margin-bottom:12px">
        <p style="margin:0;font-weight:600;color:#b45309">
          <strong>Tip!</strong> Update your business profile in HighLevel (or your CRM) to match the output from A2P Wizard. You can change it back as soon as you get approved. It also helps to set the business email to the email generated on your A2P site.
        </p>
      </div>

      <div class="callout" style="background:#fff4e6;border-color:#ffd69a">
        <p style="margin:0 0 8px;font-size:14px;color:var(--muted);font-weight:600">üì∏ Example ‚Äî Business Profile Setup</p>
        <div class="img-preview-wrap" onclick="this.classList.toggle('expanded')" style="cursor:pointer">
          <img
            src="https://storage.googleapis.com/msgsndr/FXf64ueUkUQhuZojV04e/media/698e8c23772de9363968fc5e.png"
            class="tips-img"
            alt="Opt-in form example"
            loading="lazy"
            decoding="async"
            style="margin-top:0"
          >
          <div class="img-preview-fade">
            <span>Click to view full example ‚ñº</span>
          </div>
        </div>

        <p style="margin:16px 0 8px;font-size:14px;color:var(--muted);font-weight:600">üì∏ Example ‚Äî Business Profile Details</p>
        <div class="img-preview-wrap" onclick="this.classList.toggle('expanded')" style="cursor:pointer">
          <img
            src="https://assets.cdn.filesafe.space/komZ0pRB88cwzgvEo7MW/media/699d0a955dfd5006439e28ce.png"
            class="tips-img"
            alt="Business profile details example"
            loading="lazy"
            decoding="async"
            style="margin-top:0"
          >
          <div class="img-preview-fade">
            <span>Click to view full example ‚ñº</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Copy-paste divider -->
    <div class="section" style="text-align:center;padding:20px 28px;background:linear-gradient(180deg,#f9f9ff,#fff)">
      <h2 style="justify-content:center;font-size:22px;margin-bottom:4px">üìã Copy These Exactly Into Your Application</h2>
      <p class="muted" style="margin:0;font-size:14px">Paste each field below into the matching section of your A2P campaign registration.</p>
    </div>

    <div class="section">
      <h2>üìÉ Step 1: Use Case Description</h2>
      <pre id="useCase">Loading use case description...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('useCase', this)">Copy</button>
      </div>
    </div>

    <div class="section">
      <h2>üí¨ Step 2: Sample Messages</h2>

      <p style="margin:0 0 6px"><strong>Sample Message One:</strong></p>
      <pre id="msg1">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('msg1', this)">Copy</button>
      </div>

      <p style="margin-top:16px;margin-bottom:6px"><strong>Sample Message Two:</strong></p>
      <pre id="msg2">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('msg2', this)">Copy</button>
      </div>
    </div>

    <div class="section">
      <h2>‚úÖ Step 3: HighLevel Opt-In Method</h2>

      <p>
        HighLevel now requires an <strong>Opt-In Method</strong> and a
        <strong>public Opt-in Form / Image URL</strong>.
      </p>

      <ul>
        <li><strong>Opt-In Method:</strong> Website form</li>
        <li>
          <strong>Opt-in Form / Image URL:</strong><br>
          Paste the link below into the HighLevel field exactly as shown.
        </li>
      </ul>

      <pre id="optInFormUrl">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('optInFormUrl', this)">Copy Opt-In URL</button>
      </div>

      <p style="margin-top:10px;font-size:14px;color:var(--muted)">
        ‚úÖ This link must be publicly accessible and show clear consent language.
      </p>
    </div>

    <div class="section">
      <h2>‚úÖ Step 4: How do Contacts Opt-in to Messages?</h2>
      <pre id="consentCopy">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('consentCopy', this)">Copy</button>
      </div>
    </div>

    <div class="section">
      <h2>üìú Step 5: Opt-In Message</h2>
      <pre id="optInMessage">Loading...</pre>
      <div class="copy-row">
        <button class="copy-btn" onclick="copyText('optInMessage', this)">Copy</button>
      </div>
    </div>

    <div class="section">
      <h2>üí° Tips for Approval</h2>
      <ul>
        <li>Submit between 8am‚Äì11am on weekdays</li>
        <li>Use a fresh number/campaign if resubmitting</li>
        <li>Brand approval usually takes ~15 minutes</li>
        <li><strong>Follow all best practices</strong> to avoid delays</li>
      </ul>
      <img
        src="https://i.ibb.co/S4JzfBYz/image-4.png"
        class="tips-img"
        alt="Tips Screenshot"
        loading="lazy"
        decoding="async"
        width="1200"
        height="675"
      >
      <div class="callout tip-callout" style="margin-top:16px">
        <p style="margin:0;font-size:14px">
          ‚ö†Ô∏è <strong>Website not generating?</strong>
          Make sure you did not use special characters in the company name.
          Special characters do not work for web addresses. üôÇ
        </p>
      </div>
    </div>

    <div class="pdf-section">
      <h3>Need to send this to a client? Here's a white-labeled guide!</h3>
      <a href="#" onclick="window.print()" class="pdf-button">Download PDF</a>
    </div>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);
    function cacheKey(q){ return "a2p_results_" + String(q || "").toLowerCase().trim(); }

    const API_BASE = "https://script.google.com/macros/s/AKfycbxc0m07Q1u1c3JyyKAKTdYvmrkj6C9UxdI-wjIZM7b0uidEreM-G31Ub3LQCObmhiIs/exec";
    const SITE_DOMAIN = "nebulabrandgroup.com";

    /* Random name pairs: [customer, rep] */
    const NAME_PAIRS = [
      ["Adam","Alex"],["Sarah","Jordan"],["Mike","Taylor"],["Emma","Casey"],
      ["James","Morgan"],["Lisa","Riley"],["David","Sam"],["Rachel","Jamie"],
      ["Chris","Drew"],["Nicole","Avery"],["Matt","Quinn"],["Katie","Blake"],
      ["Ryan","Dana"],["Laura","Reese"],["Josh","Skyler"],["Megan","Pat"],
      ["Brian","Robin"],["Amy","Cameron"],["Kevin","Jesse"],["Jenna","Bailey"]
    ];
    function pickNames(){
      const a = NAME_PAIRS[Math.floor(Math.random()*NAME_PAIRS.length)];
      let b = a;
      while(b===a) b = NAME_PAIRS[Math.floor(Math.random()*NAME_PAIRS.length)];
      return {c1:a[0], r1:a[1], c2:b[0], r2:b[1]};
    }

    async function fetchJSON(url, timeoutMs=12000){
      const ctrl = new AbortController();
      const t = setTimeout(()=>ctrl.abort(), timeoutMs);
      try{
        const r = await fetch(url, {signal: ctrl.signal, cache: "no-store"});
        if(!r.ok) throw new Error("HTTP "+r.status);
        return await r.json();
      } finally { clearTimeout(t); }
    }

    function updateText(id, text){
      const el=$(id);
      if (!el) return;
      el.textContent = text;
    }

    function normalizeSlug(slugRaw){
      return String(slugRaw || "")
        .toLowerCase()
        .trim()
        .replace(/\s+/g, "")
        .replace(/[_]/g, "-")
        .replace(/[^a-z0-9-]/g, "");
    }

    function buildWebsiteFromSlug(slugRaw){
      const s = normalizeSlug(slugRaw);
      if(!s) return { ok:false, website:"" };
      return { ok:true, website: `https://${s}.${SITE_DOMAIN}` };
    }

    function unwrapRow(resp){
      if(!resp) return null;
      if(resp.ok === false) return resp;
      return resp.data || resp.record || resp.row || resp.result || resp;
    }

    function setWebsiteUI(website){
      const siteLinkA = $("siteLinkA");
      const upgradePrompt = $("upgradePrompt");

      if(siteLinkA){
        if(website){
          siteLinkA.textContent = website;
          siteLinkA.href = website;
          // Hide upgrade prompt if website is available
          if(upgradePrompt) upgradePrompt.style.display = "none";
        }else{
          siteLinkA.textContent = "Website generation unavailable";
          siteLinkA.href = "#";
          // Show upgrade prompt if no website
          if(upgradePrompt) upgradePrompt.style.display = "block";
        }
      }
    }

    function hydrate(row){
      if(row && row.ok === false){
        setWebsiteUI("");
        updateText("useCase", "Lookup failed. This record could not be found from the endpoint.");
        updateText("msg1", "‚Äî");
        updateText("msg2", "‚Äî");
        updateText("consentCopy", "‚Äî");
        updateText("optInMessage", "‚Äî");
        updateText("optInFormUrl", "‚Äî");
        return;
      }

      const businessName =
        String((row && (row["Legal Business name"] || row["Legal Business Name"] || row["business_name"])) || "").trim();

      const slug =
        String((row && (row["Slug"] || row["slug"] || row["SLUG"])) || "").trim();

      const bn = businessName || "Client Business";

      const websiteRes = buildWebsiteFromSlug(slug);
      const website = websiteRes.ok ? websiteRes.website : "";
      const phone = String((row && (row["Support Phone"] || row["support_phone"])) || "").trim() || "[BUSINESS PHONE]";
      const marketingConsent = String((row && (row["Marketing Consent"] || row["marketing_consent"])) || "").trim() || "promotional offers, discounts, and updates";
      const nonMarketingConsent = String((row && (row["Non-Marketing Consent"] || row["non_marketing_consent"])) || "").trim() || "service updates and inquiries";
      
      setWebsiteUI(website);

      updateText("optInFormUrl", (website ? website + "/contact" : "Website link not available yet"));

      const names = pickNames();

      updateText("useCase",
`This campaign, operated by ${bn}, sends non-promotional SMS messages to customers regarding ${nonMarketingConsent}. Customers may also opt in to receive promotional notifications, including ${marketingConsent}. Messages are only sent to users who provide explicit consent via an online form. Message frequency varies, up to 4 messages per month. Message & data rates may apply. Recipients can reply STOP to opt out at any time.`
);

updateText("msg1",
`Hi ${names.c1}, this is ${names.r1} from ${bn}. You opted in at ${website || "[WEBSITE LINK PENDING]"} to receive SMS updates. We wanted to follow up regarding your inquiry. Reply STOP to opt out or HELP for help. Msg & data rates may apply.`
);

updateText("msg2",
`Hi ${names.c2}, this is ${names.r2} from ${bn}. Thanks for opting in to receive SMS updates from us. A team member will reach out within the next 24 hours. Reply STOP to opt out or HELP for help. Msg & data rates may apply.`
);

updateText("consentCopy",
`Users opt in by submitting their mobile phone number and actively selecting one or both consent checkboxes on the contact form at ${website || "[WEBSITE LINK PENDING]"}/contact . The checkboxes describe the categories of messages they will receive, as reflected in the Use Case above.`
);

updateText("optInMessage",
`You are opted in to receive SMS messages from ${bn}. Message frequency varies, up to 4 messages per month. Message and data rates may apply. Reply STOP to opt out or HELP for assistance.`
);
    }

    async function init(){
      const params = new URLSearchParams(location.search);
      const slug = params.get("slug");
      const id = params.get("id");
      const queryVal = (slug || id || "").trim();

      if(!queryVal){
        setWebsiteUI("");
        updateText("useCase", "Waiting for data‚Ä¶");
        updateText("msg1", "Waiting for data‚Ä¶");
        updateText("msg2", "Waiting for data‚Ä¶");
        updateText("consentCopy", "Waiting for data‚Ä¶");
        updateText("optInMessage", "Waiting for data‚Ä¶");
        updateText("optInFormUrl", "Waiting for a link‚Ä¶");
        return;
      }

      const key = cacheKey(queryVal);
      const apiUrl = slug
        ? (API_BASE + "?slug=" + encodeURIComponent(slug))
        : (API_BASE + "?id=" + encodeURIComponent(id));

      try{
        const cached = localStorage.getItem(key);
        if(cached){
          const cachedObj = JSON.parse(cached);
          hydrate(unwrapRow(cachedObj));
          fetchJSON(apiUrl)
            .then(d=>{ localStorage.setItem(key, JSON.stringify(d)); hydrate(unwrapRow(d)); })
            .catch(()=>{});
          return;
        }
      }catch(e){}

      try{
        const data = await fetchJSON(apiUrl, 12000);
        localStorage.setItem(key, JSON.stringify(data));
        hydrate(unwrapRow(data));
      }catch(err){
        console.error("Error fetching data", err);
        setWebsiteUI("");
        updateText("useCase", "We're having trouble loading live data. Try refreshing, or check back in a minute.");
      }
    }

    function copyText(elId, btn){
      const el=$(elId);
      if(!el) return;

      const txt = (el.tagName === "A")
        ? (el.href && el.href !== "#" ? el.href : el.textContent.trim())
        : (el.textContent || "").trim();

      if(!txt || txt === "Loading‚Ä¶") return;

      navigator.clipboard.writeText(txt).then(()=>{
        const msg=document.createElement("span");
        msg.className="copied-msg";
        msg.textContent="‚úì Copied!";
        btn.insertAdjacentElement("afterend", msg);
        setTimeout(()=>msg.remove(), 1400);
      });
    }

    init();
  </script>
</body>
</html>
